import streamlit as st
import joblib
import numpy as np
import matplotlib.pyplot as plt

# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞ CSS ‡πÅ‡∏ö‡∏ö Modern Dark Sport
st.set_page_config(page_title="Football Value Predictor 2026", page_icon="‚öΩ")

st.markdown("""
    <style>
    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏Å */
    .stApp {
        background: linear-gradient(135deg, #0e1117 0%, #072a07 100%);
    }
    
    /* Sidebar ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏ö‡∏ö‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏ï */
    [data-testid="stSidebar"] {
        background-color: #1b4332 !important;
    }
    
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå */
    .stButton>button {
        width: 100%;
        border-radius: 15px;
        background-color: #2d6a4f !important;
        color: #d8f3dc !important;
        font-weight: bold;
        border: 2px solid #52b788 !important;
        transition: 0.3s;
    }
    
    .stButton>button:hover {
        background-color: #40916c !important;
        box-shadow: 0px 0px 15px #52b788;
    }

    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
    .stSuccess {
        background-color: rgba(45, 106, 79, 0.3) !important;
        border: 1px solid #52b788 !important;
        color: #d8f3dc !important;
    }
    </style>
    """, unsafe_allow_html=True)

# 2. ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• (‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ model ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô)
@st.cache_resource
def load_my_model():
    try:
        return joblib.load('football_model.pkl')
    except:
        return None

model = load_my_model()

# 3. ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.title("Football Value Predictor 2026")
st.write("‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô")

# Sidebar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
import streamlit as st
import joblib
import numpy as np

# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞ CSS ‡∏ò‡∏µ‡∏° "Scout Report"
st.set_page_config(page_title="Football Scout Report", page_icon="üïµÔ∏è")

st.markdown("""
    <style>
    .stApp { background: linear-gradient(135deg, #0e1117 0%, #1b4332 100%); color: #ffffff; }
    [data-testid="stSidebar"] { background-color: #1b4332 !important; }
    .stMetric { background-color: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; border: 1px solid #52b788; }
    .stButton>button { width: 100%; border-radius: 10px; background-color: #52b788 !important; color: #0e1117 !important; font-weight: bold; height: 3em; }
    </style>
    """, unsafe_allow_html=True)

# 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•
@st.cache_resource
def load_model():
    try:
        return joblib.load('football_model.pkl')
    except:
        return None

model = load_model()

# 3. ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
st.title("üïµÔ∏è Football Scout Report 2026")
st.write("‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏∞‡∏ö‡∏ö AI")

with st.sidebar:
    st.header("üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞")
    player_name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞", "‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢")
    age = st.number_input("‡∏≠‡∏≤‡∏¢‡∏∏", 15, 45, 25)
    goals = st.number_input("‡∏õ‡∏£‡∏∞‡∏ï‡∏π", 0, 100, 10)
    assists = st.number_input("‡πÅ‡∏≠‡∏™‡∏ã‡∏¥‡∏™‡∏ï‡πå", 0, 100, 5)
    minutes = st.number_input("‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏•‡∏á‡πÄ‡∏•‡πà‡∏ô", 0, 5000, 1500)
    contract = st.slider("‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏õ‡∏µ)", 0, 5, 3)
    
    st.divider()
    # ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ R-squared ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
    st.metric("Model Confidence", "85.4%") 

# 4. ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
if st.button("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Scout)"):
    if model is not None:
        # ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏à‡∏≤‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
        features = np.array([[age, goals, assists, minutes, contract]])
        predicted_value = model.predict(features)[0]
        
        # ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏•‡∏≤‡∏î (Market Price) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤
        # ‡πÄ‡∏£‡∏≤‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ Top 30 ‡∏ó‡∏µ‡πà 105 ‡∏•‡πâ‡∏≤‡∏ô‡∏¢‡∏π‡πÇ‡∏£
        market_avg = 105.0 
        
        # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (0-100%)
        # ‡∏¢‡∏¥‡πà‡∏á‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡∏•‡∏≤‡∏î ‡∏¢‡∏¥‡πà‡∏á‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á
        suitability = (predicted_value / 200) * 100 # ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏î‡∏≤‡∏ô 200M ‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡∏Å
        suitability = min(max(suitability, 0), 100) # ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0-100

        # --- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ---
        st.divider()
        st.subheader(f"üîç ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏°‡∏ß‡∏°‡∏≠‡∏á: {player_name}")
        
        col1, col2 = st.columns(2)
        with col1:
            st.metric("‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏î‡∏¢ AI", f"{predicted_value:.2f} M‚Ç¨")
        with col2:
            st.metric("‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°", f"{suitability:.1f}%")

        # --- ‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Decision Logic) ---
        st.write("### üì¢ ‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô:")
        if suitability >= 75:
            st.success(f"üåü **‡∏£‡∏∞‡∏î‡∏±‡∏ö World Class:** {player_name} ‡∏°‡∏µ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏Å‡πà‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡πà‡∏°‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ñ‡∏ß‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ")
        elif suitability >= 50:
            st.info(f"‚öΩ **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô:** {player_name} ‡∏°‡∏µ‡∏ù‡∏µ‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á")
        else:
            st.warning(f"‚ö†Ô∏è **‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:** ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏π‡∏á‡∏ô‡∏±‡∏Å ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ")
            
    else:
        st.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏°‡πÄ‡∏î‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î football_model.pkl ‡∏Ç‡∏∂‡πâ‡∏ô GitHub")